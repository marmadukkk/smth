# README: Онлайн-доска объявлений колледжа (Python-версия)

## Описание проекта

Это веб-приложение представляет собой онлайн-доску объявлений, ориентированную на студентов колледжа. Пользователи могут размещать, просматривать, комментировать и лайкать объявления в различных категориях, таких как "Buy/Sell" (Куплю/Продам), "Events" (События), "Lost/Found" (Потерянные/Найденные вещи), "Housing" (Жилье) и "Jobs" (Работа). Приложение поддерживает аутентификацию пользователей, модерацию администратором, поиск, пагинацию, уведомления и темы интерфейса (светлая/темная). 

Приложение построено на стеке Python: 
- Backend: Flask
- Шаблонизатор: Jinja2 (встроенный в Flask)
- База данных: SQLite3
- Дополнительно: Bootstrap для фронтенда, Werkzeug для безопасности и загрузки файлов.

Приложение обеспечивает безопасность (хэшированные пароли, проверки на бан), и предназначено для локального запуска или деплоя на платформах вроде Vercel (с адаптацией для облачных БД, так как SQLite не идеален для serverless-окружений).

## Требования

- Python (версия 3.8+)
- pip (для установки зависимостей)
- Браузер для тестирования (рекомендуется Chrome или Firefox)

## Установка

1. Клонируйте репозиторий:
   ```
   git clone <URL_репозитория>
   cd <директория_проекта>
   ```

2. Создайте виртуальное окружение (рекомендуется):
   ```
   python -m venv venv
   ```

3. Установите зависимости:
   ```
   pip install flask sqlite3 werkzeug functools csv
   ```

4. Создайте директории:
   - `templates/` для HTML-шаблонов (скопируйте шаблоны из кода)
   - `static/uploads/` для изображений

## Запуск

Запустите сервер:
```
python app.py
```
Приложение доступно по адресу `http://localhost:5000` (или порт, указанный в коде).

Для разработки используйте `FLASK_DEBUG=1` для режима отладки.

## Функционал

### Общий функционал
- **Темы интерфейса**: Переключение между светлой и темной темой (роут `/toggle_theme`). Тема сохраняется в сессии.
- **Навигация**: Главная панель с категориями, поиск, добавление объявлений (для авторизованных), уведомления, логин/регистрация/логаут.
- **Поиск объявлений**: Роут `/search` с формой для запроса по заголовку/описанию, категории, дате (от/до). Результаты отображаются с пагинацией.
- **Пагинация**: В списках объявлений (по категориям или поиску) — 10 элементов на страницу, с навигацией (предыдущая/следующая/номера страниц).

### Пользовательский функционал
- **Регистрация и аутентификация**:
  - Регистрация: Роут `/register` с формой (username, password (хэшируется), email). Уникальность проверяется.
  - Логин: Роут `/login` с проверкой credentials, сессия сохраняется.
  - Логаут: Роут `/logout` для очистки сессии.
- **Объявления**:
  - Просмотр: По категориям (`/category/<id>`) или детально (`/ad/<id>`). Отображает заголовок, описание, изображение, дату, автора, лайки, комментарии.
  - Добавление: Роут `/add_ad` с формой (заголовок, описание, категория, изображение — опционально, поддержка PNG/JPG/GIF/JPEG, размер до 16MB).
  - Редактирование: Роут `/edit_ad/<id>` только для своих объявлений, обновление полей и изображения.
  - Удаление: Роут `/delete_ad/<id>` только для своих, с модальным подтверждением в шаблоне.
- **Взаимодействие**:
  - Комментарии: Добавление под объявлением (POST на `/ad/<id>`, только авторизованные, не забаненные). Уведомление владельцу объявления.
  - Лайки: Роут `/like/<id>` (только один раз на объявление, для авторизованных).
- **Уведомления**: In-app список на `/notifications` (о новых комментариях). Отмечаются как прочитанные при просмотре.
- **Баны**: Забаненные пользователи не могут добавлять/комментировать/лайкать (проверки в декораторах `@login_required` и функции `is_banned`).

### Администраторский функционал
- **Логин админа**: Роут `/admin` с формой, credentials: username 'admin', password 'password' (хэшируется при инициализации).
- **Панель админа** (`/admin/panel`):
  - Список объявлений: ID, заголовок, описание, категория, автор. Действия: редактирование (`/admin/edit_ad/<id>`), удаление (`/admin/delete/<id>`).
  - Список пользователей: ID, username, email. Действия: бан (`/admin/ban/<id>`) / анбан (`/admin/unban/<id>`) с причиной.
  - Статистика: Количество объявлений по категориям.
  - Экспорт: Роут `/admin/export_csv` для скачивания объявлений в CSV (ads.csv).
- **Модерация**: Редактирование любых объявлений (аналогично пользовательскому, но без ограничений).
- **Логаут админа**: Роут `/admin/logout` для очистки сессии админа.

### Безопасность и валидация
- Хэширование паролей (werkzeug.security: generate_password_hash, check_password_hash).
- Декораторы для аутентификации (`@login_required`, `@admin_required`) и проверки банов.
- Защита от SQL-инъекций (параметризованные запросы в sqlite3).
- Ограничения на файлы: Только разрешенные расширения (ALLOWED_EXTENSIONS), secure_filename, MAX_CONTENT_LENGTH.
- Флэш-сообщения (flash) для ошибок (например, "Invalid credentials").

## Структура проекта

- `app.py`: Основной файл сервера, роуты, логика, инициализация БД.
- `database.db`: Файл БД (генерируется автоматически при запуске).
- `templates/`: HTML-шаблоны с Jinja2 (base.html, index.html, category.html, ad_detail.html, add_ad.html, edit_ad.html, search.html, register.html, login.html, notifications.html, admin_login.html, admin_panel.html, admin_edit_ad.html).
- `static/`: Статические файлы (CSS, JS, если нужно).
  - `uploads/`: Изображения объявлений.
- `requirements.txt`: Список зависимостей (для pip install -r requirements.txt).

## Зависимости

Создайте файл `requirements.txt` с содержимым:
```
flask==3.0.0
werkzeug==3.0.1
```

Установите с помощью `pip install -r requirements.txt`.
